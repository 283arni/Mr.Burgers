!function(){const e=document.querySelectorAll(".accordeon__item");for(item of e)item.addEventListener("click",n);const t=document.querySelectorAll(".accordeon__list");for(itemMenu of t)itemMenu.addEventListener("click",n);function n(n){n.preventDefault();const c=n.currentTarget;c.classList.contains("active")?(o(e),o(t)):(o(e),o(t),function(e){const t=e.querySelector(".accordeon__who"),n=e.querySelector(".accordeon__desc-hid");e.classList.add("active"),t?t.style.height="100%":n.style.width="100%"}(c))}function o(t){Array.from(t).forEach(n=>{n.classList.remove("active"),t==e?n.querySelector(".accordeon__who").style.height=0:n.querySelector(".accordeon__desc-hid").style.width=0})}}(),function(){const e=$(".hero__svg");var t=e.offset().left,n=e.offset().top;document.body.clientWidth>768&&$(".hero").mousemove(function(o){var c=o.pageY;!function(o,c){var i=(o-t)/100+"px",r=(c-n)/50+"px";e.css({left:i,top:r})}(o.pageX,c)})}(),ymaps.ready(init);var myPlacemarks=[{coords:59.938433,coords2:30.306681,hint:"Бургеры на Адмиралтейской набережной, 10"},{coords:59.966402,coords2:30.311461,hint:"Бургеры на Каменноостровском проспекте, 37"},{coords:59.946715,coords2:30.434368,hint:"Бургеры на проспекте Энергетиков, 16"}];function init(){var e=new ymaps.Map("map",{center:[59.939095,30.315868],zoom:12,controls:["geolocationControl","zoomControl","searchControl"]});e.behaviors.disable("scrollZoom"),myPlacemarks.forEach(function(t){var n=new ymaps.Placemark([t.coords,t.coords2],{hintContent:t.hint},{iconLayout:"default#image",iconImageHref:"/images/contacts/map-marker.svg",iconImageSize:[46,57]});e.geoObjects.add(n)})}!function(){const e=document.querySelector(".nav__little"),t=document.querySelector(".hamburger"),n=document.querySelector(".hamburger .close__link");e.addEventListener("click",function(e){e.preventDefault(),t.style.display="flex"}),n.addEventListener("click",function(e){e.preventDefault(),t.style.display="none"}),t.addEventListener("click",function(e){e.target===t&&n.click()}),$("[data-skroll]").on("click",function(e){t.style.display="none"})}(),function(){const e=document.querySelector("#modal-popup").innerHTML,t=document.querySelectorAll(".btn_phone"),n=document.querySelectorAll(".btn_none"),o=document.querySelector(".comments__story");document.querySelector(".popup__message");for(i=0;i<t.length;i++)t[i].addEventListener("click",function(e){e.preventDefault();const t=c(o.innerHTML);document.body.appendChild(t)});for(i=0;i<n.length;i++)n[i].addEventListener("click",function(e){e.preventDefault();const t=c(o.innerHTML);document.body.appendChild(t)});function c(t){const n=document.createElement("div");n.classList.add("popup"),n.innerHTML=e,n.querySelector(".popup__message").innerHTML=t;const o=n.querySelector(".close__popup .close__link");return o.addEventListener("click",e=>{e.preventDefault(),document.body.removeChild(n)}),n.addEventListener("click",e=>{e.target===n&&o.click()}),n}const r=/^((8|\+7)[\- ]?)?(\(?\d{3}\)?[\-]?)?[\d\- ]{7,10}$/,l=/^[а-яА-Я]{2,30}|[a-zA-Z]{2,30}$/,s=/^[А-Яа-я0-9\ \.,!\?\-@]+$/,a=document.querySelector("#form");var d=document.querySelector("#sendBtn");function u(e,t){e.nextElementSibling.style.display="block",e.nextElementSibling.textContent=t}function m(e){e.nextElementSibling.style.display="none"}function v(e){if(l.test(a.name.value))m(a.name);else{const t="Введите адекватное имя. Пример: Степан, Billy, Иоган.";u(a.name,t),e=!1}if(r.test(a.phone.value))m(a.phone);else{const t="Введите верный номер телефона. Пример: +7 123 456 78 90, 1234567890.";u(a.phone,t),e=!1}if(s.test(a.comment.value))m(a.comment);else{const t="Введите комментарий. Не больше 150 символов. Разрешено только кириллица, символы ! , . ? - @.";u(a.comment,t),e=!1}return e}a.addEventListener("keydown",()=>{v(!0)}),a.addEventListener("submit",t=>{if(t.preventDefault(),v(!0),v(!0)){const t=new FormData(a);t.append("to","mail@mail.com");const n=new XMLHttpRequest;n.open("POST","https://webdev-api.loftschool.com/sendmail"),n.send(t),n.addEventListener("load",()=>{const t=function(t){const n=document.createElement("div"),o=document.createElement("input");return n.classList.add("popup"),n.innerHTML=e,n.querySelector(".popup__message").innerHTML=t,n.firstElementChild.firstElementChild.remove(),o.classList.add("btn","btn_modal"),o.type="submit",o.value="Закрыть",n.firstElementChild.appendChild(o),n}(JSON.parse(n.responseText).message);n.status>=400?document.body.appendChild("Что-то сломалось..."):(document.body.appendChild(t),function(e){document.querySelector(".btn_modal").addEventListener("click",t=>{t.preventDefault(),document.body.removeChild(e)})}(t))})}d.disabled=!0,setTimeout(function(){d.disabled=!1},3e3)})}(),$(document).ready(function(){var e=$(".wrapper"),t=$(".section"),n=$(".maincontainer");function o(e){$(".nav-sections__circle").removeClass("active").eq(e).addClass("active")}function c(e){1==e||6==e||8==e?($(".nav-sections__point").css("background-color","#2f3234"),$(".nav-sections__circle").css("border-color","transparent"),$(".nav-sections__circle.active").css("border-color","#2f3234")):($(".nav-sections__point").css("background-color","#fff"),$(".nav-sections__circle").css("border-color","transparent"),$(".nav-sections__circle.active").css("border-color","#fff"))}function i(){document.body.clientWidth<480&&(v.classList.contains("active")?(a.call(document),u.style.display="none"):(s.call(document.body),u.style.display="block"),m.addEventListener("click",e=>{e.preventDefault(),u.style.display="none",a.call(document)}))}var r=!1;function l(e,t){let n=$(".nav-sections__circle").filter(".active");40!=e&&"up"!=t||n.next().click(),38!=e&&"down"!=t||n.prev().click()}e.on("wheel",function(e){e.preventDefault();var i,l=t.filter(".active"),s=l.next(),a=l.prev();function d(e,t){n.animate({bottom:100*e+"vh"},700,function(){l.removeClass("active"),c(e)})}!1===r&&(r=!0,e.originalEvent.deltaY>0?(s.length?(i=s.index(),s.addClass("active")):(i=t.first().index(),t.first().addClass("active")),d(i),o(i)):(a.length?(i=a.index(),a.addClass("active")):(i=t.last().index(),t.last().addClass("active")),d(i),o(i)),setTimeout(()=>{r=!1},1500))}),$("[data-skroll]").on("click",function(e){e.preventDefault();const r=$(this).attr("data-skroll");var l;t.removeClass("active"),$(".section").eq(r).addClass("active"),l=r,n.animate({bottom:100*l+"vh"},700,function(){}),o(r),c(r),i()});var s=document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen,a=document.exitFullscreen||document.mozCancelFullScreen||document.webkitExitFullscreen||document.msExitFullscreen;const d=new MobileDetect(window.navigator.userAgent).mobile(),u=document.querySelector(".up"),m=document.querySelector(".arrow__up"),v=document.querySelector(".hero");d&&$(".maincontainer").swipe({swipe:function(e,t){l("",t),i()}}),$(document).on("keydown",e=>{switch(e.keyCode){case 40:case 38:e.preventDefault(),l(e.keyCode)}})});const containerVideo=document.querySelector(".video__player"),video=document.querySelector(".video__burger"),player=document.querySelector(".video__controls"),play=document.querySelector(".video__start"),trackDot=document.querySelector(".video__track-dot"),track=document.querySelector(".video__line"),volume=document.querySelector(".video__volume"),volumeTrack=document.querySelector(".video__volume-line"),volumeDot=document.querySelector(".video__volume-dot"),playScreen=document.querySelector(".video__play-screen");function defaultVolume(){const e=video.volume=.2;volumeDot.style.left=Math.floor(e*volumeTrack.clientWidth)+"px"}function playPause(){video.paused?video.play():video.pause(),containerVideo.classList.toggle("pause")}function timeUpdate(){const e=Math.floor(video.currentTime)/Math.floor(video.duration);trackDot.style.left=`${Math.floor(e*track.clientWidth)}px`}function setCurrentTime(e){const t=e.offsetX/track.clientWidth;video.currentTime=t*video.duration}function muted(e){e.currentTarget.classList.toggle("mute"),video.muted=!video.muted}function setVolume(e){volumeDot.style.left=`${e.offsetX}px`,video.volume=e.offsetX/e.currentTarget.clientWidth,0===video.volume?volume.classList.add("mute"):volume.classList.remove("mute")}video.addEventListener("canplaythrough",function(){defaultVolume()}),play.addEventListener("click",function(){playPause()}),playScreen.addEventListener("click",function(){playPause()}),video.addEventListener("timeupdate",function(){timeUpdate()}),track.addEventListener("click",function(e){setCurrentTime(e)}),volume.addEventListener("click",function(e){muted(e)}),volumeTrack.addEventListener("click",function(e){setVolume(e)}),function(){const e=document.querySelector(".burgers__slider"),t=document.querySelector(".burgers__right"),n=document.querySelector(".burgers__left");document.querySelector(".burgers__slider-item");t.addEventListener("click",t=>{t.preventDefault(),e.appendChild(e.firstElementChild)}),n.addEventListener("click",t=>{t.preventDefault(),e.insertBefore(e.lastElementChild,e.firstElementChild)})}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFjY29yZGVvbi5qcyIsImRyb3BzLmpzIiwibWFwLmpzIiwibWVudVBob25lLmpzIiwibW9kYWwuanMiLCJvbmVwYWdlc2Nyb2xsLmpzIiwicGxheWVyLmpzIiwic2xpZGVyLmpzIl0sIm5hbWVzIjpbIml0ZW1zIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiaXRlbSIsImFkZEV2ZW50TGlzdGVuZXIiLCJtYWluRnVuYyIsIml0ZW1zTWVudSIsIml0ZW1NZW51IiwiZSIsInByZXZlbnREZWZhdWx0IiwibGkiLCJjdXJyZW50VGFyZ2V0IiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJjbG9zZUFuZFJlbW92ZUFjdGl2ZSIsIm9iaiIsImluZm8iLCJxdWVyeVNlbGVjdG9yIiwiZGVzYyIsImFkZCIsInN0eWxlIiwiaGVpZ2h0Iiwid2lkdGgiLCJvcGVuQW5kQ3JlYXRBY3RpdmUiLCJBcnJheSIsImZyb20iLCJmb3JFYWNoIiwiZWxlbSIsInJlbW92ZSIsImRyb3BzIiwiJCIsInBvc1giLCJvZmZzZXQiLCJsZWZ0IiwicG9zWSIsInRvcCIsImJvZHkiLCJjbGllbnRXaWR0aCIsIm1vdXNlbW92ZSIsIm1vdmVZIiwicGFnZVkiLCJtb3ZlWCIsImNvcmRzWCIsImNvcmRzWSIsImNzcyIsIm1vdmVEcm9wcyIsInBhZ2VYIiwieW1hcHMiLCJyZWFkeSIsImluaXQiLCJteVBsYWNlbWFya3MiLCJjb29yZHMiLCJjb29yZHMyIiwiaGludCIsIm15TWFwIiwiTWFwIiwiY2VudGVyIiwiem9vbSIsImNvbnRyb2xzIiwiYmVoYXZpb3JzIiwiZGlzYWJsZSIsIm15UGxhY2VtYXJrIiwiUGxhY2VtYXJrIiwiaGludENvbnRlbnQiLCJpY29uTGF5b3V0IiwiaWNvbkltYWdlSHJlZiIsImljb25JbWFnZVNpemUiLCJnZW9PYmplY3RzIiwibWVudSIsImZ1bGxNZW51IiwiY2xvc2VNZW51IiwiZXZlbnQiLCJkaXNwbGF5IiwidGFyZ2V0IiwiY2xpY2siLCJvbiIsIm1vZGFsIiwiaW5uZXJIVE1MIiwiYnRuUmVhZCIsImJ0blJlYWQyIiwiY29tbWVudCIsImkiLCJsZW5ndGgiLCJibG9jayIsImNyZWF0ZUJsb2NrIiwiYXBwZW5kQ2hpbGQiLCJ0ZXh0IiwiZGl2IiwiY3JlYXRlRWxlbWVudCIsImJ0bkNsb3NlIiwicmVtb3ZlQ2hpbGQiLCJ2YWxpZFRlbCIsInZhbGlkTmFtZSIsInZhbGlkQ29tbWVudCIsImlzRm9ybSIsInNlbmRCdG4iLCJjcmVhdGVFcnJvciIsIm5laWdoYm9yIiwibWVzc2FnZSIsIm5leHRFbGVtZW50U2libGluZyIsInRleHRDb250ZW50IiwicmVtb3ZlRXJyb3IiLCJ2YWxpZGF0ZUZvcm0iLCJ2YWxpZCIsInRlc3QiLCJuYW1lIiwidmFsdWUiLCJlcnJvcmVOYW1lIiwicGhvbmUiLCJlcnJvcmVQaG9uZSIsImZvcm0iLCJGb3JtRGF0YSIsImFwcGVuZCIsInhociIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInNlbmQiLCJkaXZGb3JtIiwiaW5wdXQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsInR5cGUiLCJjcmVhdGVNb2RhbCIsIkpTT04iLCJwYXJzZSIsInJlc3BvbnNlVGV4dCIsInN0YXR1cyIsImRlbGV0ZU1vZHVsIiwiZGlzYWJsZWQiLCJzZXRUaW1lb3V0IiwiY29udGFpbmVyU2Nyb2xsIiwic2VjdGlvbiIsInNsaWRlckNvbnRhaW5lciIsImFjdGl2ZURvdCIsImluZGV4IiwicmVtb3ZlQ2xhc3MiLCJlcSIsImFkZENsYXNzIiwiY29sb3JEb3QiLCJpbmRleFNlY3Rpb24iLCJmdWxsU2NyZWVuIiwic2VjdGlvbkhlcm8iLCJjYW5jZWxGdWxsU2NyZWVuIiwiY2FsbCIsImRpdlVwIiwicmVxdWVzdEZ1bGxTY3JlZW4iLCJhcnJvd1VwIiwiaW5zY3JvbGwiLCJ0b3VjaEFuZEtleSIsImtleUNvZGUiLCJkaXJlY3Rpb24iLCJpbWl0YXRpb25DbGljayIsImZpbHRlciIsIm5leHQiLCJwcmV2Iiwic2VjdGlvbkFjdCIsIm5leHRTZWN0aW9uIiwicHJldlNlY3Rpb24iLCJzY3JvbGxXaGVlbCIsInBvc1NlY3Rpb24iLCJhbmltYXRlIiwiYm90dG9tIiwib3JpZ2luYWxFdmVudCIsImRlbHRhWSIsImZpcnN0IiwibGFzdCIsImluZGV4TGluayIsInRoaXMiLCJhdHRyIiwicmVxdWVzdEZ1bGxzY3JlZW4iLCJtb3pSZXF1ZXN0RnVsbFNjcmVlbiIsIndlYmtpdFJlcXVlc3RGdWxsU2NyZWVuIiwibXNSZXF1ZXN0RnVsbHNjcmVlbiIsImV4aXRGdWxsc2NyZWVuIiwibW96Q2FuY2VsRnVsbFNjcmVlbiIsIndlYmtpdEV4aXRGdWxsc2NyZWVuIiwibXNFeGl0RnVsbHNjcmVlbiIsImlzTW9iaWxlIiwiTW9iaWxlRGV0ZWN0Iiwid2luZG93IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwibW9iaWxlIiwic3dpcGUiLCJjb250YWluZXJWaWRlbyIsInZpZGVvIiwicGxheWVyIiwicGxheSIsInRyYWNrRG90IiwidHJhY2siLCJ2b2x1bWUiLCJ2b2x1bWVUcmFjayIsInZvbHVtZURvdCIsInBsYXlTY3JlZW4iLCJkZWZhdWx0Vm9sdW1lIiwidm9sIiwiTWF0aCIsImZsb29yIiwicGxheVBhdXNlIiwicGF1c2UiLCJ0b2dnbGUiLCJ0aW1lVXBkYXRlIiwicHJvZ3Jlc3MiLCJjdXJyZW50VGltZSIsImR1cmF0aW9uIiwic2V0Q3VycmVudFRpbWUiLCJ4Iiwib2Zmc2V0WCIsIm11dGVkIiwic2V0Vm9sdW1lIiwic2xpZGVyIiwiYnRuUmlnaHQiLCJidG5MZXRmIiwiaW5zZXJ0QmVmb3JlIiwibGFzdEVsZW1lbnRDaGlsZCJdLCJtYXBwaW5ncyI6IkNBQUEsV0FHQSxNQUFBQSxFQUFBQyxTQUFBQyxpQkFBQSxvQkFFQSxJQUFBQyxRQUFBSCxFQUNBRyxLQUFBQyxpQkFBQSxRQUFBQyxHQUlBLE1BQUFDLEVBQUFMLFNBQUFDLGlCQUFBLG9CQUVBLElBQUFLLFlBQUFELEVBQ0FDLFNBQUFILGlCQUFBLFFBQUFDLEdBSUEsU0FBQUEsRUFBQUcsR0FDQUEsRUFBQUMs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Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcclxuICAvL2FjY29yZGVvbiB0ZWFtXHJcblxyXG4gIGNvbnN0IGl0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbl9faXRlbScpO1xyXG5cclxuICBmb3IgKGl0ZW0gb2YgaXRlbXMpIHtcclxuICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtYWluRnVuYyk7XHJcbiAgfVxyXG5cclxuICAvL2FjY29yZGVvbiBtZW51XHJcbiAgY29uc3QgaXRlbXNNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFjY29yZGVvbl9fbGlzdCcpO1xyXG5cclxuICBmb3IgKGl0ZW1NZW51IG9mIGl0ZW1zTWVudSkge1xyXG4gICAgaXRlbU1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtYWluRnVuYyk7XHJcbiAgfVxyXG5cclxuICAvL21haW5GdW5jc2lvbnNcclxuICBmdW5jdGlvbiBtYWluRnVuYyhlKSB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCBsaSA9IGUuY3VycmVudFRhcmdldDtcclxuXHJcbiAgICBpZiAobGkuY2xhc3NMaXN0LmNvbnRhaW5zKCdhY3RpdmUnKSkge1xyXG4gICAgICBjbG9zZUFuZFJlbW92ZUFjdGl2ZShpdGVtcyk7XHJcbiAgICAgIGNsb3NlQW5kUmVtb3ZlQWN0aXZlKGl0ZW1zTWVudSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNsb3NlQW5kUmVtb3ZlQWN0aXZlKGl0ZW1zKTtcclxuICAgICAgY2xvc2VBbmRSZW1vdmVBY3RpdmUoaXRlbXNNZW51KVxyXG4gICAgICBvcGVuQW5kQ3JlYXRBY3RpdmUobGkpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcblxyXG4gIGZ1bmN0aW9uIG9wZW5BbmRDcmVhdEFjdGl2ZShvYmopIHtcclxuICAgIGNvbnN0IGluZm8gPSBvYmoucXVlcnlTZWxlY3RvcignLmFjY29yZGVvbl9fd2hvJyk7XHJcbiAgICBjb25zdCBkZXNjID0gb2JqLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX2Rlc2MtaGlkJylcclxuICAgIG9iai5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgIGlmIChpbmZvKSB7XHJcbiAgICAgIGluZm8uc3R5bGUuaGVpZ2h0ID0gJzEwMCUnO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgZGVzYy5zdHlsZS53aWR0aCA9ICcxMDAlJztcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIGNsb3NlQW5kUmVtb3ZlQWN0aXZlKG9iaikge1xyXG4gICAgQXJyYXkuZnJvbShvYmopLmZvckVhY2goZWxlbSA9PiB7XHJcbiAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7XHJcbiAgICAgIGlmIChvYmogPT0gaXRlbXMpIHtcclxuICAgICAgICBlbGVtLnF1ZXJ5U2VsZWN0b3IoJy5hY2NvcmRlb25fX3dobycpLnN0eWxlLmhlaWdodCA9IDA7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZWxlbS5xdWVyeVNlbGVjdG9yKCcuYWNjb3JkZW9uX19kZXNjLWhpZCcpLnN0eWxlLndpZHRoID0gMDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgY29uc3QgZHJvcHMgPSAkKCcuaGVyb19fc3ZnJyk7XHJcblxyXG4gIHZhciBwb3NYID0gZHJvcHMub2Zmc2V0KCkubGVmdDtcclxuICB2YXIgcG9zWSA9IGRyb3BzLm9mZnNldCgpLnRvcDtcclxuXHJcbiAgZnVuY3Rpb24gbW92ZURyb3BzKG1vdmVYLCBtb3ZlWSkge1xyXG4gICAgdmFyIGNvcmRzWCA9IChtb3ZlWCAtIHBvc1gpIC8gMTAwICsgJ3B4JztcclxuICAgIHZhciBjb3Jkc1kgPSAobW92ZVkgLSBwb3NZKSAvIDUwICsgJ3B4JztcclxuICAgIGRyb3BzLmNzcyh7XHJcbiAgICAgIGxlZnQ6IGNvcmRzWCxcclxuICAgICAgdG9wOiBjb3Jkc1lcclxuICAgIH0pXHJcbiAgfVxyXG5cclxuICBpZiAoZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCA+IDc2OCkge1xyXG4gICAgJCgnLmhlcm8nKS5tb3VzZW1vdmUoZnVuY3Rpb24gKGUpIHtcclxuICAgICAgdmFyIG1vdmVZID0gZS5wYWdlWTtcclxuICAgICAgdmFyIG1vdmVYID0gZS5wYWdlWDtcclxuICAgICAgbW92ZURyb3BzKG1vdmVYLCBtb3ZlWSk7XHJcbiAgICB9KVxyXG4gIH1cclxuXHJcblxyXG59KSgpOyIsInltYXBzLnJlYWR5KGluaXQpO1xyXG5cclxudmFyIG15UGxhY2VtYXJrcyA9IFt7XHJcbiAgICBjb29yZHM6IDU5LjkzODQzMyxcclxuICAgIGNvb3JkczI6IDMwLjMwNjY4MSxcclxuICAgIGhpbnQ6IFwi0JHRg9GA0LPQtdGA0Ysg0L3QsCDQkNC00LzQuNGA0LDQu9GC0LXQudGB0LrQvtC5INC90LDQsdC10YDQtdC20L3QvtC5LCAxMFwiXHJcbiAgfSxcclxuICB7XHJcbiAgICBjb29yZHM6IDU5Ljk2NjQwMixcclxuICAgIGNvb3JkczI6IDMwLjMxMTQ2MSxcclxuICAgIGhpbnQ6IFwi0JHRg9GA0LPQtdGA0Ysg0L3QsCDQmtCw0LzQtdC90L3QvtC+0YHRgtGA0L7QstGB0LrQvtC8INC/0YDQvtGB0L/QtdC60YLQtSwgMzdcIlxyXG4gIH0sXHJcbiAge1xyXG4gICAgY29vcmRzOiA1OS45NDY3MTUsIFxyXG4gICAgY29vcmRzMjogMzAuNDM0MzY4LFxyXG4gICAgaGludDogXCLQkdGD0YDQs9C10YDRiyDQvdCwINC/0YDQvtGB0L/QtdC60YLQtSDQrdC90LXRgNCz0LXRgtC40LrQvtCyLCAxNlwiXHJcbiAgfVxyXG5dXHJcblxyXG5mdW5jdGlvbiBpbml0KCkge1xyXG4gIHZhciBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gICAgY2VudGVyOiBbNTkuOTM5MDk1LCAzMC4zMTU4NjhdLFxyXG4gICAgem9vbTogMTIsXHJcbiAgICBjb250cm9sczogWydnZW9sb2NhdGlvbkNvbnRyb2wnLCd6b29tQ29udHJvbCcsJ3NlYXJjaENvbnRyb2wnXVxyXG4gIH0pO1xyXG4gIG15TWFwLmJlaGF2aW9ycy5kaXNhYmxlKCdzY3JvbGxab29tJyk7IFxyXG4gIG15UGxhY2VtYXJrcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcclxuICAgIHZhciBteVBsYWNlbWFyayA9IG5ldyB5bWFwcy5QbGFjZW1hcmsoW29iai5jb29yZHMsIG9iai5jb29yZHMyXSwge1xyXG4gICAgICBoaW50Q29udGVudDogb2JqLmhpbnRcclxuICAgIH0sIHtcclxuICAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgICBpY29uSW1hZ2VIcmVmOiAnL2ltYWdlcy9jb250YWN0cy9tYXAtbWFya2VyLnN2ZycsXHJcbiAgICAgIGljb25JbWFnZVNpemU6IFs0NiwgNTddXHJcbiAgICB9KTtcclxuICAgIG15TWFwLmdlb09iamVjdHNcclxuICAgICAgLmFkZChteVBsYWNlbWFyayk7XHJcbiAgfSlcclxufSIsIihmdW5jdGlvbigpe1xyXG4vLyBvcGVuZWQgbWVudSBmb3IgcGhvbmVcclxuY29uc3QgbWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5uYXZfX2xpdHRsZScpO1xyXG5jb25zdCBmdWxsTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5oYW1idXJnZXInKTtcclxuY29uc3QgY2xvc2VNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmhhbWJ1cmdlciAuY2xvc2VfX2xpbmsnKTtcclxuXHJcbm1lbnUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGZ1bGxNZW51LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7XHJcbn0pO1xyXG5cclxuY2xvc2VNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICBmdWxsTWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG59KTtcclxuXHJcbmZ1bGxNZW51LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgaWYgKGV2ZW50LnRhcmdldCA9PT0gZnVsbE1lbnUpIHtcclxuICAgIGNsb3NlTWVudS5jbGljaygpO1xyXG4gIH1cclxufSk7XHJcblxyXG4kKCdbZGF0YS1za3JvbGxdJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICBmdWxsTWVudS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG59KTtcclxufSkoKTtcclxuIiwiKGZ1bmN0aW9uICgpIHtcclxuICAvLyBtb2RhbCB3aW5kb3dcclxuXHJcbiAgY29uc3QgbW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbW9kYWwtcG9wdXAnKS5pbm5lckhUTUw7XHJcbiAgY29uc3QgYnRuUmVhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5idG5fcGhvbmUnKTtcclxuICBjb25zdCBidG5SZWFkMiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5idG5fbm9uZScpO1xyXG4gIGNvbnN0IGNvbW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuY29tbWVudHNfX3N0b3J5Jyk7XHJcbiAgbGV0IHBvcE1lc3MgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX21lc3NhZ2UnKVxyXG5cclxuICBmb3IgKGkgPSAwOyBpIDwgYnRuUmVhZC5sZW5ndGg7IGkrKykge1xyXG4gICAgYnRuUmVhZFtpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICAgY29uc3QgYmxvY2sgPSBjcmVhdGVCbG9jayhjb21tZW50LmlubmVySFRNTCk7XHJcbiAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYmxvY2spO1xyXG5cclxuICAgIH0pO1xyXG4gIH1cclxuICBmb3IgKGkgPSAwOyBpIDwgYnRuUmVhZDIubGVuZ3RoOyBpKyspIHtcclxuICAgIGJ0blJlYWQyW2ldLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgICBjb25zdCBibG9jayA9IGNyZWF0ZUJsb2NrKGNvbW1lbnQuaW5uZXJIVE1MKTtcclxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChibG9jayk7XHJcblxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBmdW5jdGlvbiBjcmVhdGVCbG9jayh0ZXh0KSB7XHJcbiAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxyXG4gICAgZGl2LmNsYXNzTGlzdC5hZGQoJ3BvcHVwJyk7XHJcbiAgICBkaXYuaW5uZXJIVE1MID0gbW9kYWw7XHJcbiAgICBsZXQgcG9wTWVzcyA9IGRpdi5xdWVyeVNlbGVjdG9yKCcucG9wdXBfX21lc3NhZ2UnKTtcclxuICAgIHBvcE1lc3MuaW5uZXJIVE1MID0gdGV4dDtcclxuXHJcbiAgICBjb25zdCBidG5DbG9zZSA9IGRpdi5xdWVyeVNlbGVjdG9yKCcuY2xvc2VfX3BvcHVwIC5jbG9zZV9fbGluaycpO1xyXG4gICAgYnRuQ2xvc2UuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGRpdik7XHJcbiAgICB9KTtcclxuXHJcbiAgICBkaXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcclxuICAgICAgaWYgKGUudGFyZ2V0ID09PSBkaXYpIHtcclxuICAgICAgICBidG5DbG9zZS5jbGljaygpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gZGl2O1xyXG4gIH1cclxuXHJcbiAgLy8gdmFsaWRhdGUgZm9ybVxyXG5cclxuICBjb25zdCB2YWxpZFRlbCA9IC9eKCg4fFxcKzcpW1xcLSBdPyk/KFxcKD9cXGR7M31cXCk/W1xcLV0/KT9bXFxkXFwtIF17NywxMH0kLztcclxuICBjb25zdCB2YWxpZE5hbWUgPSAvXlvQsC3Rj9CQLdCvXXsyLDMwfXxbYS16QS1aXXsyLDMwfSQvO1xyXG4gIGNvbnN0IHZhbGlkQ29tbWVudCA9IC9eW9CQLdCv0LAt0Y8wLTlcXCBcXC4sIVxcP1xcLUBdKyQvO1xyXG4gIGNvbnN0IGlzRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNmb3JtJyk7XHJcbiAgdmFyIHNlbmRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc2VuZEJ0bicpO1xyXG4gIHZhciB2YWxpZCA9IHRydWU7XHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZUVycm9yKG5laWdoYm9yLCBtZXNzYWdlKSB7XHJcbiAgICBuZWlnaGJvci5uZXh0RWxlbWVudFNpYmxpbmcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgICBuZWlnaGJvci5uZXh0RWxlbWVudFNpYmxpbmcudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xyXG4gIH1cclxuXHJcblxyXG4gIGZ1bmN0aW9uIHJlbW92ZUVycm9yKG5laWdoYm9yKSB7XHJcbiAgICBuZWlnaGJvci5uZXh0RWxlbWVudFNpYmxpbmcuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHZhbGlkYXRlRm9ybSh2YWxpZCkge1xyXG4gICAgXHJcbiAgICBpZiAoIXZhbGlkTmFtZS50ZXN0KGlzRm9ybS5uYW1lLnZhbHVlKSkge1xyXG4gICAgICBjb25zdCBlcnJvcmVOYW1lID0gXCLQktCy0LXQtNC40YLQtSDQsNC00LXQutCy0LDRgtC90L7QtSDQuNC80Y8uINCf0YDQuNC80LXRgDog0KHRgtC10L/QsNC9LCBCaWxseSwg0JjQvtCz0LDQvS5cIjtcclxuICAgICAgY3JlYXRlRXJyb3IoaXNGb3JtLm5hbWUsIGVycm9yZU5hbWUpO1xyXG4gICAgICB2YWxpZCA9IGZhbHNlXHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZW1vdmVFcnJvcihpc0Zvcm0ubmFtZSlcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXZhbGlkVGVsLnRlc3QoaXNGb3JtLnBob25lLnZhbHVlKSkge1xyXG4gICAgICBjb25zdCBlcnJvcmVQaG9uZSA9IFwi0JLQstC10LTQuNGC0LUg0LLQtdGA0L3Ri9C5INC90L7QvNC10YAg0YLQtdC70LXRhNC+0L3QsC4g0J/RgNC40LzQtdGAOiArNyAxMjMgNDU2IDc4IDkwLCAxMjM0NTY3ODkwLlwiO1xyXG4gICAgICBjcmVhdGVFcnJvcihpc0Zvcm0ucGhvbmUsIGVycm9yZVBob25lKTtcclxuICAgICAgdmFsaWQgPSBmYWxzZVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVtb3ZlRXJyb3IoaXNGb3JtLnBob25lKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXZhbGlkQ29tbWVudC50ZXN0KGlzRm9ybS5jb21tZW50LnZhbHVlKSkge1xyXG4gICAgICBjb25zdCBlcnJvcmVQaG9uZSA9IFwi0JLQstC10LTQuNGC0LUg0LrQvtC80LzQtdC90YLQsNGA0LjQuS4g0J3QtSDQsdC+0LvRjNGI0LUgMTUwINGB0LjQvNCy0L7Qu9C+0LIuINCg0LDQt9GA0LXRiNC10L3QviDRgtC+0LvRjNC60L4g0LrQuNGA0LjQu9C70LjRhtCwLCDRgdC40LzQstC+0LvRiyAhICwgLiA/IC0gQC5cIjtcclxuICAgICAgY3JlYXRlRXJyb3IoaXNGb3JtLmNvbW1lbnQsIGVycm9yZVBob25lKTtcclxuICAgICAgdmFsaWQgPSBmYWxzZVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVtb3ZlRXJyb3IoaXNGb3JtLmNvbW1lbnQpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHZhbGlkO1xyXG4gIH1cclxuXHJcbiAgaXNGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoKSA9PiB7XHJcbiAgICBcclxuICAgIHZhbGlkYXRlRm9ybSh2YWxpZCk7XHJcbiAgfSlcclxuXHJcbiAgaXNGb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgXHJcbiAgICB2YWxpZGF0ZUZvcm0odmFsaWQpO1xyXG5cclxuICAgIGlmICh2YWxpZGF0ZUZvcm0odmFsaWQpKSB7XHJcblxyXG4gICAgICBjb25zdCBmb3JtID0gbmV3IEZvcm1EYXRhKGlzRm9ybSk7XHJcblxyXG4gICAgICBmb3JtLmFwcGVuZCgndG8nLCAnbWFpbEBtYWlsLmNvbScpO1xyXG4gICAgICBjb25zdCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcclxuICAgICAgeGhyLm9wZW4oJ1BPU1QnLCAnaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsJyk7XHJcbiAgICAgIHhoci5zZW5kKGZvcm0pO1xyXG4gICAgICB4aHIuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpID0+IHtcclxuICAgICAgICBjb25zdCBibG9jayA9IGNyZWF0ZU1vZGFsKEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlVGV4dCkubWVzc2FnZSk7XHJcbiAgICAgICAgaWYgKHhoci5zdGF0dXMgPj0gNDAwKSB7XHJcbiAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKCfQp9GC0L4t0YLQviDRgdC70L7QvNCw0LvQvtGB0YwuLi4nKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChibG9jayk7XHJcbiAgICAgICAgICBkZWxldGVNb2R1bChibG9jayk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzZW5kQnRuLmRpc2FibGVkID0gdHJ1ZTtcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICBzZW5kQnRuLmRpc2FibGVkID0gZmFsc2U7XHJcbiAgICB9LCAzMDAwKVxyXG4gIH0pXHJcblxyXG5cclxuXHJcblxyXG4gIC8vY3JlYXRlIG1vZGFsIGZvciBmb3JtXHJcblxyXG4gIGZ1bmN0aW9uIGNyZWF0ZU1vZGFsKHRleHQpIHtcclxuICAgIGNvbnN0IGRpdkZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgIGRpdkZvcm0uY2xhc3NMaXN0LmFkZCgncG9wdXAnKTtcclxuICAgIGRpdkZvcm0uaW5uZXJIVE1MID0gbW9kYWw7XHJcbiAgICBsZXQgcG9wTWVzcyA9IGRpdkZvcm0ucXVlcnlTZWxlY3RvcignLnBvcHVwX19tZXNzYWdlJyk7XHJcbiAgICBwb3BNZXNzLmlubmVySFRNTCA9IHRleHQ7XHJcblxyXG4gICAgZGl2Rm9ybS5maXJzdEVsZW1lbnRDaGlsZC5maXJzdEVsZW1lbnRDaGlsZC5yZW1vdmUoKTtcclxuICAgIGlucHV0LmNsYXNzTGlzdC5hZGQoJ2J0bicsICdidG5fbW9kYWwnKTtcclxuICAgIGlucHV0LnR5cGUgPSAnc3VibWl0J1xyXG4gICAgaW5wdXQudmFsdWUgPSBcItCX0LDQutGA0YvRgtGMXCI7XHJcbiAgICBkaXZGb3JtLmZpcnN0RWxlbWVudENoaWxkLmFwcGVuZENoaWxkKGlucHV0KTtcclxuXHJcbiAgICByZXR1cm4gZGl2Rm9ybVxyXG4gIH1cclxuXHJcbiAgLy9yZW1vdmUgbW9kdWxcclxuICBmdW5jdGlvbiBkZWxldGVNb2R1bChlbGVtKSB7XHJcbiAgICBjb25zdCBjbG9zZUJ0bk1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmJ0bl9tb2RhbCcpO1xyXG4gICAgY2xvc2VCdG5Nb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbSk7XHJcbiAgICB9KTtcclxuICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgLy9PbmVQYWdlU2Nyb2xsXHJcblxyXG4gICQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgY29udGFpbmVyU2Nyb2xsID0gJCgnLndyYXBwZXInKSxcclxuICAgICAgc2VjdGlvbiA9ICQoJy5zZWN0aW9uJyksXHJcbiAgICAgIHNsaWRlckNvbnRhaW5lciA9ICQoJy5tYWluY29udGFpbmVyJylcclxuXHJcbiAgICBmdW5jdGlvbiBzY3JvbGwoaW5kZXhTZWN0aW9uLCBwb3NTZWN0aW9uKSB7XHJcbiAgICAgIHNsaWRlckNvbnRhaW5lci5hbmltYXRlKHtcclxuICAgICAgICAgICdib3R0b20nOiBpbmRleFNlY3Rpb24gKiAxMDAgKyAndmgnXHJcbiAgICAgICAgfSxcclxuICAgICAgICA3MDAsXHJcbiAgICAgICAgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgICAgIHBvc1NlY3Rpb25cclxuICAgICAgICB9XHJcbiAgICAgIClcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBhY3RpdmVEb3QoaW5kZXgpIHtcclxuICAgICAgJCgnLm5hdi1zZWN0aW9uc19fY2lyY2xlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpLmVxKGluZGV4KS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY29sb3JEb3QoaW5kZXhTZWN0aW9uKSB7XHJcbiAgICAgIGlmIChpbmRleFNlY3Rpb24gPT0gMSB8fCBpbmRleFNlY3Rpb24gPT0gNiB8fCBpbmRleFNlY3Rpb24gPT0gOCkge1xyXG4gICAgICAgICQoJy5uYXYtc2VjdGlvbnNfX3BvaW50JykuY3NzKCdiYWNrZ3JvdW5kLWNvbG9yJywgXCIjMmYzMjM0XCIpO1xyXG4gICAgICAgICQoJy5uYXYtc2VjdGlvbnNfX2NpcmNsZScpLmNzcygnYm9yZGVyLWNvbG9yJywgXCJ0cmFuc3BhcmVudFwiKTtcclxuICAgICAgICAkKCcubmF2LXNlY3Rpb25zX19jaXJjbGUuYWN0aXZlJykuY3NzKCdib3JkZXItY29sb3InLCBcIiMyZjMyMzRcIik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgJCgnLm5hdi1zZWN0aW9uc19fcG9pbnQnKS5jc3MoJ2JhY2tncm91bmQtY29sb3InLCBcIiNmZmZcIik7XHJcbiAgICAgICAgJCgnLm5hdi1zZWN0aW9uc19fY2lyY2xlJykuY3NzKCdib3JkZXItY29sb3InLCBcInRyYW5zcGFyZW50XCIpO1xyXG4gICAgICAgICQoJy5uYXYtc2VjdGlvbnNfX2NpcmNsZS5hY3RpdmUnKS5jc3MoJ2JvcmRlci1jb2xvcicsIFwiI2ZmZlwiKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGZ1bGxTY3JlZW4oKSB7XHJcbiAgICAgIGlmIChkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoIDwgNDgwKSB7XHJcbiAgICAgICAgaWYgKHNlY3Rpb25IZXJvLmNsYXNzTGlzdC5jb250YWlucygnYWN0aXZlJykpIHtcclxuICAgICAgICAgIGNhbmNlbEZ1bGxTY3JlZW4uY2FsbChkb2N1bWVudCk7XHJcbiAgICAgICAgICBkaXZVcC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICByZXF1ZXN0RnVsbFNjcmVlbi5jYWxsKGRvY3VtZW50LmJvZHkpO1xyXG4gICAgICAgICAgZGl2VXAuc3R5bGUuZGlzcGxheSA9ICdibG9jaydcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBhcnJvd1VwLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBlID0+e1xyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgZGl2VXAuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgICAgICAgIGNhbmNlbEZ1bGxTY3JlZW4uY2FsbChkb2N1bWVudCk7XHJcbiAgICAgICAgfSlcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHZhciBpbnNjcm9sbCA9IGZhbHNlO1xyXG5cclxuICAgIGNvbnRhaW5lclNjcm9sbC5vbignd2hlZWwnLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cclxuICAgICAgdmFyIHNlY3Rpb25BY3QgPSBzZWN0aW9uLmZpbHRlcignLmFjdGl2ZScpLFxyXG4gICAgICAgIG5leHRTZWN0aW9uID0gc2VjdGlvbkFjdC5uZXh0KCksXHJcbiAgICAgICAgcHJldlNlY3Rpb24gPSBzZWN0aW9uQWN0LnByZXYoKSxcclxuICAgICAgICBpbmRleFNlY3Rpb24sIHBvc1NlY3Rpb247XHJcblxyXG4gICAgICBmdW5jdGlvbiBzY3JvbGxXaGVlbChpbmRleFNlY3Rpb24sIHBvc1NlY3Rpb24pIHtcclxuXHJcbiAgICAgICAgc2xpZGVyQ29udGFpbmVyLmFuaW1hdGUoe1xyXG4gICAgICAgICAgICAnYm90dG9tJzogaW5kZXhTZWN0aW9uICogMTAwICsgJ3ZoJ1xyXG5cclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICA3MDAsXHJcbiAgICAgICAgICBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlY3Rpb25BY3QucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpXHJcbiAgICAgICAgICAgIHBvc1NlY3Rpb25cclxuICAgICAgICAgICAgY29sb3JEb3QoaW5kZXhTZWN0aW9uKVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgICAgfVxyXG4gICAgICBpZiAoaW5zY3JvbGwgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgaW5zY3JvbGwgPSB0cnVlO1xyXG4gICAgICAgIGlmIChlLm9yaWdpbmFsRXZlbnQuZGVsdGFZID4gMCkge1xyXG4gICAgICAgICAgaWYgKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBpbmRleFNlY3Rpb24gPSBuZXh0U2VjdGlvbi5pbmRleCgpO1xyXG4gICAgICAgICAgICBwb3NTZWN0aW9uID0gbmV4dFNlY3Rpb24uYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaW5kZXhTZWN0aW9uID0gc2VjdGlvbi5maXJzdCgpLmluZGV4KCk7XHJcbiAgICAgICAgICAgIHBvc1NlY3Rpb24gPSBzZWN0aW9uLmZpcnN0KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgc2Nyb2xsV2hlZWwoaW5kZXhTZWN0aW9uLCBwb3NTZWN0aW9uKTtcclxuICAgICAgICAgIGFjdGl2ZURvdChpbmRleFNlY3Rpb24pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBpZiAocHJldlNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGluZGV4U2VjdGlvbiA9IHByZXZTZWN0aW9uLmluZGV4KCk7XHJcbiAgICAgICAgICAgIHBvc1NlY3Rpb24gPSBwcmV2U2VjdGlvbi5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpbmRleFNlY3Rpb24gPSBzZWN0aW9uLmxhc3QoKS5pbmRleCgpO1xyXG4gICAgICAgICAgICBwb3NTZWN0aW9uID0gc2VjdGlvbi5sYXN0KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgc2Nyb2xsV2hlZWwoaW5kZXhTZWN0aW9uLCBwb3NTZWN0aW9uKTtcclxuICAgICAgICAgIGFjdGl2ZURvdChpbmRleFNlY3Rpb24pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIGluc2Nyb2xsID0gZmFsc2U7XHJcbiAgICAgICAgfSwgMTUwMCkgLy8g0JLRgNC10LzRjyDQvdCwINC+0YLQutCw0YIg0YHQvtCx0YvRgtC40Y8gd2hlZWxcclxuICAgICAgfVxyXG5cclxuICAgIH0pO1xyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG4gICAgJCgnW2RhdGEtc2tyb2xsXScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgY29uc3QgaW5kZXhMaW5rID0gJCh0aGlzKS5hdHRyKCdkYXRhLXNrcm9sbCcpXHJcbiAgICAgIHNlY3Rpb24ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xyXG4gICAgICBjb25zdCBwb3NBY3RpdiA9ICQoJy5zZWN0aW9uJykuZXEoaW5kZXhMaW5rKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgIHNjcm9sbChpbmRleExpbmssIHBvc0FjdGl2KTtcclxuICAgICAgYWN0aXZlRG90KGluZGV4TGluayk7XHJcbiAgICAgIGNvbG9yRG90KGluZGV4TGluayk7XHJcbiAgICAgIGZ1bGxTY3JlZW4oKVxyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gdG91Y2hBbmRLZXkoa2V5Q29kZSwgZGlyZWN0aW9uKSB7XHJcbiAgICAgIGxldCBpbWl0YXRpb25DbGljayA9ICQoJy5uYXYtc2VjdGlvbnNfX2NpcmNsZScpLmZpbHRlcignLmFjdGl2ZScpO1xyXG5cclxuICAgICAgaWYgKGtleUNvZGUgPT0gNDAgfHwgZGlyZWN0aW9uID09ICd1cCcpIHtcclxuICAgICAgICBpbWl0YXRpb25DbGljay5uZXh0KCkuY2xpY2soKTtcclxuICAgICAgICBcclxuXHJcbiAgICAgIH1cclxuICBcclxuICAgICAgaWYgKGtleUNvZGUgPT0gMzggfHwgZGlyZWN0aW9uID09ICdkb3duJykge1xyXG4gICAgICAgIGltaXRhdGlvbkNsaWNrLnByZXYoKS5jbGljaygpXHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgdmFyIHJlcXVlc3RGdWxsU2NyZWVuID0gZG9jdW1lbnQuYm9keS5yZXF1ZXN0RnVsbHNjcmVlbiB8fCBkb2N1bWVudC5ib2R5Lm1velJlcXVlc3RGdWxsU2NyZWVuIHx8IGRvY3VtZW50LmJvZHkud2Via2l0UmVxdWVzdEZ1bGxTY3JlZW4gfHwgZG9jdW1lbnQuYm9keS5tc1JlcXVlc3RGdWxsc2NyZWVuO1xyXG4gICAgdmFyIGNhbmNlbEZ1bGxTY3JlZW4gPSBkb2N1bWVudC5leGl0RnVsbHNjcmVlbiB8fCBkb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuIHx8IGRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuIHx8IGRvY3VtZW50Lm1zRXhpdEZ1bGxzY3JlZW47XHJcbiAgICB2YXIgbWQgPSBuZXcgTW9iaWxlRGV0ZWN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50KTtcclxuICAgIGNvbnN0IGlzTW9iaWxlID0gbWQubW9iaWxlKCk7XHJcbiAgICBjb25zdCBkaXZVcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy51cCcpXHJcbiAgICBjb25zdCBhcnJvd1VwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmFycm93X191cCcpO1xyXG4gICAgY29uc3Qgc2VjdGlvbkhlcm8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaGVybycpO1xyXG4gIFxyXG4gICAgaWYgKGlzTW9iaWxlKSB7XHJcbiAgICAgICQoJy5tYWluY29udGFpbmVyJykuc3dpcGUoe1xyXG4gICAgICAgIHN3aXBlOiBmdW5jdGlvbiAoZXZlbnQsIGRpcmVjdGlvbikge1xyXG4gICAgICAgICAgdG91Y2hBbmRLZXkoJycsIGRpcmVjdGlvbik7XHJcbiAgICAgICAgICBmdWxsU2NyZWVuKClcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgICQoZG9jdW1lbnQpLm9uKCdrZXlkb3duJywgKGUpID0+IHtcclxuXHJcbiAgICAgIHN3aXRjaCAoZS5rZXlDb2RlKSB7XHJcbiAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgIHRvdWNoQW5kS2V5KGUua2V5Q29kZSk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICBjYXNlIDM4OlxyXG4gICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgdG91Y2hBbmRLZXkoZS5rZXlDb2RlKTtcclxuICAgICAgICAgIGJyZWFrO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgfSk7XHJcbn0pKCk7IiwiY29uc3QgY29udGFpbmVyVmlkZW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3BsYXllcicpLFxyXG4gIHZpZGVvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX19idXJnZXInKSxcclxuICBwbGF5ZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX2NvbnRyb2xzJyksXHJcbiAgcGxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fc3RhcnQnKSxcclxuICB0cmFja0RvdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fdHJhY2stZG90JyksXHJcbiAgdHJhY2sgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX2xpbmUnKSxcclxuICB2b2x1bWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3ZvbHVtZScpLFxyXG4gIHZvbHVtZVRyYWNrID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnZpZGVvX192b2x1bWUtbGluZScpLFxyXG4gIHZvbHVtZURvdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fdm9sdW1lLWRvdCcpLFxyXG4gIHBsYXlTY3JlZW4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlkZW9fX3BsYXktc2NyZWVuJylcclxuXHJcblxyXG5mdW5jdGlvbiBkZWZhdWx0Vm9sdW1lKCkge1xyXG4gIGNvbnN0IHZvbCA9IHZpZGVvLnZvbHVtZSA9IDAuMjtcclxuICB2b2x1bWVEb3Quc3R5bGUubGVmdCA9IE1hdGguZmxvb3Iodm9sICogdm9sdW1lVHJhY2suY2xpZW50V2lkdGgpICsgJ3B4JztcclxufVxyXG5cclxuZnVuY3Rpb24gcGxheVBhdXNlKCkge1xyXG4gICh2aWRlby5wYXVzZWQpID8gdmlkZW8ucGxheSgpOiB2aWRlby5wYXVzZSgpO1xyXG4gIGNvbnRhaW5lclZpZGVvLmNsYXNzTGlzdC50b2dnbGUoJ3BhdXNlJyk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIHRpbWVVcGRhdGUoKSB7XHJcbiAgY29uc3QgcHJvZ3Jlc3MgPSBNYXRoLmZsb29yKHZpZGVvLmN1cnJlbnRUaW1lKSAvIE1hdGguZmxvb3IodmlkZW8uZHVyYXRpb24pO1xyXG4gIHRyYWNrRG90LnN0eWxlLmxlZnQgPSBgJHtNYXRoLmZsb29yKHByb2dyZXNzICogdHJhY2suY2xpZW50V2lkdGgpfXB4YDtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0Q3VycmVudFRpbWUoZSkge1xyXG4gIGNvbnN0IHggPSBlLm9mZnNldFggLyB0cmFjay5jbGllbnRXaWR0aDtcclxuICB2aWRlby5jdXJyZW50VGltZSA9IHggKiB2aWRlby5kdXJhdGlvbjtcclxufVxyXG5cclxuZnVuY3Rpb24gbXV0ZWQoZSkge1xyXG4gIGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCdtdXRlJylcclxuICB2aWRlby5tdXRlZCA9ICF2aWRlby5tdXRlZDtcclxufVxyXG5cclxuZnVuY3Rpb24gc2V0Vm9sdW1lKGUpIHtcclxuICB2b2x1bWVEb3Quc3R5bGUubGVmdCA9IGAke2Uub2Zmc2V0WH1weGA7XHJcbiAgdmlkZW8udm9sdW1lID0gZS5vZmZzZXRYIC8gZS5jdXJyZW50VGFyZ2V0LmNsaWVudFdpZHRoO1xyXG4gIHZpZGVvLnZvbHVtZSA9PT0gMCA/IHZvbHVtZS5jbGFzc0xpc3QuYWRkKCdtdXRlJyk6dm9sdW1lLmNsYXNzTGlzdC5yZW1vdmUoJ211dGUnKVxyXG59XHJcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2NhbnBsYXl0aHJvdWdoJywgZnVuY3Rpb24gKCkge1xyXG4gIGRlZmF1bHRWb2x1bWUoKTtcclxufSk7XHJcbnBsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgcGxheVBhdXNlKClcclxufSk7XHJcbnBsYXlTY3JlZW4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoKSB7XHJcbiAgcGxheVBhdXNlKClcclxufSk7XHJcbnZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ3RpbWV1cGRhdGUnLCBmdW5jdGlvbiAoKSB7XHJcbiAgdGltZVVwZGF0ZSgpO1xyXG59KTtcclxudHJhY2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gIHNldEN1cnJlbnRUaW1lKGUpO1xyXG59KTtcclxudm9sdW1lLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICBtdXRlZChlKTtcclxufSk7XHJcbnZvbHVtZVRyYWNrLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICBzZXRWb2x1bWUoZSk7XHJcbn0pO1xyXG5cclxuXHJcbiIsIihmdW5jdGlvbigpe1xyXG5cclxuLy8gc2xpZGVyIGpxdWVyeVxyXG4vLyAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XHJcblxyXG4vLyAgIHZhciBzbGlkZXIgPSBmdW5jdGlvbiAoY29udGFpbmVyLCBudW1iZXJJdGVtKSB7XHJcbi8vICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpLFxyXG5cclxuLy8gICAgICAgaXRlbXMgPSBjb250YWluZXIuZmluZCgnLmJ1cmdlcnNfX3NsaWRlci1pdGVtJyksXHJcbi8vICAgICAgIGFjdGl2ZUl0ZW0gPSBpdGVtcy5maWx0ZXIoJy5hY3RpdmUnKSxcclxuLy8gICAgICAgbmV4dEl0ZW0gPSBpdGVtcy5lcShudW1iZXJJdGVtKSxcclxuLy8gICAgICAgaW5kZXhJdGVtID0gbmV4dEl0ZW0uaW5kZXgoKSxcclxuLy8gICAgICAgbGlzdCA9IGNvbnRhaW5lci5maW5kKCcuYnVyZ2Vyc19fc2xpZGVyJyk7XHJcblxyXG4vLyAgICAgaWYgKG5leHRJdGVtLmxlbmd0aCkge1xyXG4vLyAgICAgICBsaXN0LmFuaW1hdGUoe1xyXG4vLyAgICAgICAgICAgJ3JpZ2h0JzogaW5kZXhJdGVtICogMTAwICsgJyUnLFxyXG4vLyAgICAgICAgIH0sXHJcbi8vICAgICAgICAgJ2Zhc3QnLFxyXG4vLyAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuLy8gICAgICAgICAgIGFjdGl2ZUl0ZW0ucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpLFxyXG4vLyAgICAgICAgICAgICBuZXh0SXRlbS5hZGRDbGFzcygnYWN0aXZlJylcclxuLy8gICAgICAgICB9XHJcbi8vICAgICAgIClcclxuLy8gICAgIH1cclxuLy8gICB9XHJcblxyXG4vLyAgICQoJy5idXJnZXJzX19idG4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4vLyAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4vLyAgICAgdmFyIGNvbnRhaW5lciA9ICQoJy5idXJnZXJzX193aW5kb3cnKSxcclxuLy8gICAgICAgaXRlbXMgPSAkKCcuYnVyZ2Vyc19fc2xpZGVyLWl0ZW0nLCBjb250YWluZXIpLFxyXG4vLyAgICAgICBhY3RJdGVtID0gaXRlbXMuZmlsdGVyKCcuYWN0aXZlJyksXHJcbi8vICAgICAgIG51bUl0ZW0sIHBvc2l0aW9uSXRlbSwgcmVxSXRlbTtcclxuXHJcbi8vICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYnVyZ2Vyc19fcmlnaHQnKSkge1xyXG4vLyAgICAgICBudW1JdGVtID0gYWN0SXRlbS5uZXh0KCk7XHJcbi8vICAgICAgIHBvc2l0aW9uSXRlbSA9IGl0ZW1zLmZpcnN0KCk7XHJcbi8vICAgICB9XHJcblxyXG4vLyAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2J1cmdlcnNfX2xlZnQnKSkge1xyXG4vLyAgICAgICBudW1JdGVtID0gYWN0SXRlbS5wcmV2KCk7XHJcbi8vICAgICAgIHBvc2l0aW9uSXRlbSA9IGl0ZW1zLmxhc3QoKTtcclxuLy8gICAgIH1cclxuXHJcbi8vICAgICByZXFJdGVtID0gbnVtSXRlbS5sZW5ndGggPyBudW1JdGVtLmluZGV4KCkgOiBwb3NpdGlvbkl0ZW0uaW5kZXgoKVxyXG4vLyAgICAgc2xpZGVyKGNvbnRhaW5lciwgcmVxSXRlbSk7XHJcbi8vICAgfSk7XHJcbi8vIH0pO1xyXG5cclxuLy9zbGlkZXJcclxuXHJcbmNvbnN0IHNsaWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXJzX19zbGlkZXInKTtcclxuY29uc3QgYnRuUmlnaHQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnVyZ2Vyc19fcmlnaHQnKTtcclxuY29uc3QgYnRuTGV0ZiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXJzX19sZWZ0JylcclxuY29uc3Qgc2xpZGVyQ2hpbGQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuYnVyZ2Vyc19fc2xpZGVyLWl0ZW0nKTtcclxuXHJcblxyXG5idG5SaWdodC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGU9PntcclxuICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgc2xpZGVyLmFwcGVuZENoaWxkKHNsaWRlci5maXJzdEVsZW1lbnRDaGlsZClcclxuXHJcbn0pXHJcblxyXG5idG5MZXRmLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZT0+e1xyXG4gIGUucHJldmVudERlZmF1bHQoKTtcclxuICBzbGlkZXIuaW5zZXJ0QmVmb3JlKHNsaWRlci5sYXN0RWxlbWVudENoaWxkLCBzbGlkZXIuZmlyc3RFbGVtZW50Q2hpbGQpXHJcbn0pXHJcblxyXG59KSgpOyJdfQ==
